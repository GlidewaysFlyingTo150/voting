<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Glideways — Vote Totals</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="card" id="totalsCard">
    <header>
      <h1>Vote Totals</h1>
      <p class="muted small">Updated live (refreshes every 8s)</p>
    </header>

    <div id="totalsContainer">
      <p class="muted small">Loading totals…</p>
    </div>
  </main>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxtJCHVt4Gh89UgC0AX0ZTpsRF8LgIqlUQN-DaQt7gpKnZV9xb5mRVUgNN2Xh9RL1Z7/exec";

async function fetchTotals() {
  try {
    const res = await fetch(SCRIPT_URL + "?action=totals");
    if (!res.ok) throw new Error("HTTP " + res.status);
    const json = await res.json();
    if (json.status !== "success" || !json.totals) {
      document.getElementById("totalsContainer").innerText = "No totals yet.";
      return;
    }

    const totals = json.totals;
    const container = document.getElementById("totalsContainer");
    container.innerHTML = "";

    // For each category, create a sublist of choices and counts
    for (const [category, choices] of Object.entries(totals)) {
      const catEl = document.createElement("div");
      catEl.className = "category-block";
      const h = document.createElement("h3");
      h.innerText = category;
      catEl.appendChild(h);

      const ul = document.createElement("ul");
      for (const [choice, count] of Object.entries(choices)) {
        const li = document.createElement("li");
        li.innerText = `${choice}: ${count} vote(s)`;
        ul.appendChild(li);
      }
      catEl.appendChild(ul);
      container.appendChild(catEl);
    }
  } catch (err) {
    console.error("fetchTotals error:", err);
    document.getElementById("totalsContainer").innerText = "Error loading totals.";
  }
}

fetchTotals();
setInterval(fetchTotals, 8000);
</script>
</body>
</html>
