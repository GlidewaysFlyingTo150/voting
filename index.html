<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Glideways Voting</title>
</head>
<body>
  <h1>Glideways Voting</h1>

  <!-- Login -->
  <div id="login-section">
    <button id="login">Login with Google</button>
  </div>

  <!-- User info -->
  <div id="user-info" style="margin-top: 10px;"></div>

  <!-- Voting -->
  <div id="voting-section" style="margin-top: 20px; display: none;">
    <h2>Vote for Your Favorite Option</h2>
    <button class="vote" data-option="Option1">Option 1</button>
    <button class="vote" data-option="Option2">Option 2</button>
    <button class="vote" data-option="Option3">Option 3</button>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";
    const loginButton = document.getElementById("login");
    const userInfoDiv = document.getElementById("user-info");
    const votingSection = document.getElementById("voting-section");

    // Check login
    const token = localStorage.getItem("google_token");
    const name = localStorage.getItem("google_name");
    const email = localStorage.getItem("google_email");

    function showUser(name) {
      userInfoDiv.textContent = `Logged in as ${name}`;
      loginButton.style.display = "none";
      votingSection.style.display = "block";
    }

    if (token && name) showUser(name);

    // Login button
    loginButton.addEventListener("click", () => {
      const clientId = "YOUR_GOOGLE_CLIENT_ID";
      const redirectUri = encodeURIComponent(SCRIPT_URL);
      const scope = encodeURIComponent("openid email profile");
      const googleUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}&access_type=online&prompt=select_account`;
      window.location.href = googleUrl;
    });

    // Voting buttons
    document.querySelectorAll(".vote").forEach(button => {
      button.addEventListener("click", async () => {
        if (!localStorage.getItem("google_token")) return alert("You must log in first!");

        const vote = button.dataset.option;
        const payload = {
          name: localStorage.getItem("google_name"),
          email: localStorage.getItem("google_email"),
          vote: vote
        };

        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        });
        const data = await res.json();
        if (data.success) alert(`Vote recorded for ${vote}`);
        else alert("Error recording vote: " + (data.message || data.error));
      });
    });
  </script>
</body>
</html>
