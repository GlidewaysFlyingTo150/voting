<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Glideways Voting</title>
<link rel="stylesheet" href="styles.css">

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
let userEmail = null; 

function handleCredentialResponse(response) {
    const jwt = parseJwt(response.credential);
    userEmail = jwt.email;

    document.getElementById("login-section").style.display = "none";
    document.getElementById("vote-section").style.display = "block";
}

function parseJwt(token) {
    return JSON.parse(atob(token.split('.')[1]));
}

async function submitVote(option) {
    document.getElementById("loading").style.display = "flex";

    try {
        await fetch("https://script.google.com/macros/s/AKfycbwJklZ2sMbKJ6gCnmIvF7FJECSryGNX4xBHE10U42jq-pHTO9rj1GOvJG5cMf2BcP9k/exec", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                email: userEmail,
                vote: option
            })
        });

        document.getElementById("loading").style.display = "none";
        const msg = document.getElementById("success-message");
        msg.style.opacity = "1";

        setTimeout(() => msg.style.opacity = "0", 2500);

    } catch (e) {
        alert("Error submitting vote.");
    }
}
</script>

</head>

<body>

<div class="container">

    <!-- LOGIN -->
    <div id="login-section">
        <h1 class="title">Glideways Voting</h1>
        <div id="g_id_onload"
            data-client_id="232951174632-hkb769otpi9k5re4avti8mv3vamsg7hk.apps.googleusercontent.com"
            data-callback="handleCredentialResponse">
        </div>

        <div class="g_id_signin" 
            data-type="standard"
            data-shape="pill"
            data-theme="outline"
            data-text="signin_with"
            data-size="large">
        </div>
    </div>

    <!-- VOTING -->
    <div id="vote-section" style="display: none;">
        <h2 class="subtitle">Cast Your Vote</h2>

        <button class="vote-btn" onclick="submitVote('Option A')">Option A</button>
        <button class="vote-btn" onclick="submitVote('Option B')">Option B</button>
        <button class="vote-btn" onclick="submitVote('Option C')">Option C</button>

        <a href="results.html" class="results-link">View Results →</a>
    </div>

    <!-- SUCCESS MESSAGE -->
    <div id="success-message">✔ Vote Submitted!</div>

    <!-- LOADING SPINNER -->
    <div id="loading">
        <div class="spinner"></div>
    </div>

</div>

</body>
</html>
